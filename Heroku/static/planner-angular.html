<?xml version="1.0"?>
<!doctype html [
	&lt;!ATTLIST li ng-repeat NMTOKENS&gt;
]>
<html lang="en" class="ui-stretch" ng-app="app">
<head>
<meta charset="utf-8">
<title>Cineworld Cinemas Planner</title>

<script type="text/javascript">
	window.onerror = function() {
		window.error = arguments;
		var args = Array.prototype.slice.call(arguments);
		args.push("See window.error from console for more");
		alert(args.join("\n"));
	};
</script>
<script src="/scripts/libs/jquery/jquery-1.10.2.js"></script>
<script src="/scripts/libs/angular/angular.js"></script>
<script src="/scripts/libs/angular/angular-animate.js"></script>
<script src="/scripts/libs/angular/angular-resource.js"></script>
<script src="/scripts/libs/angular/angular-route.js"></script>
<script src="/lib/bootstrap/js/bootstrap.min.js"></script>
<script src="/scripts/libs/angular/plugins/ui-bootstrap-tpls-0.7.0.js"></script>

<script src="/scripts/planner-angular/app.js"></script>
<script src="/scripts/planner-angular/utils.js"></script>
<script src="/scripts/planner-angular/controllers.js"></script>
<script src="/scripts/planner-angular/services.js"></script>
<script src="/scripts/planner-angular/filters.js"></script>
<script src="/scripts/planner-angular/directives.js"></script>
<script src="/scripts/planner-angular/animations.js"></script>

<script type="text/javascript" src="/scripts/libs/moment/moment-with-langs-2.4.0.js"></script>
<script type="text/javascript" src="/scripts/libs/moment/moment-range-0.1.9.js"></script>
<script type="text/javascript" src="/lib/utilities/lodash-2.4.1.js"></script>

<link href="/lib/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
<link rel="stylesheet" type="text/css" href="/styles/planner-angular.css" />
</head>
<body class="ui-stretch" ng-controller="AppController">
	<section id="main" class="ui-stretch">
		<header id="date" ng-controller="DateController">
			<form class="form-inline" role="form">
				<label for="date">Date</label>
				<input id="date" type="text" datepicker-popup="shortDate" ng-model="cineworld.date" ng-required="true" is-open="opened" ng-change="changed()" />
				<button class="btn" ng-click="open()"><i class="icon-calendar"></i></button>
				Selected date is: <em>{{cineworld.date | date:'fullDate' }}</em>
			</div>
		</header>
		<aside id="debug" ng-controller="DebugController">
			Selected cinemas: {{(cineworld.cinemas | filter:{selected: true}).length}} / {{cineworld.cinemas.length}}
			<ul>
				<li ng-repeat="cinema in cineworld.cinemas | filter:{selected: true} | orderBy:'name'">
					<span>{{cinema.name}} ({{cinema.cineworldID}})</span>
				</li>
			</ul>

			Selected films: {{(cineworld.films | filter:{selected: true}).length}} / {{cineworld.films.length}}
			<ul>
				<li ng-repeat="film in cineworld.films | filter:{selected: true} | orderBy:'title'">
					<span>{{film.title}} ({{film.edi}})</span>
				</li>
			</ul>
		</aside>
		<section id="cinemas" class="ui-stretch" ng-controller="CinemasController">
			<div ng-show="loading">Loading cinemas...</div>
			<script type="text/ng-template" id="cinema.shtml">
				<i class="icon-favorite pull-right" ng-class="{grayscale: !cinema.fav, loading: cinema.favLoading}" ng-click="favClick(cinema)" />
				<label class="name" for="cinema-{{cinema.cineworldID}}" title="{{cinema | json}}">
					<input id="cinema-{{cinema.cineworldID}}" type="checkbox" class="check" value="{{cinema.cineworldID}}" ng-model="cinema.selected" />
					{{cinema.name}}
				</label>
			</script>
			<ul class="inline">
				<li ng-repeat="(id, button) in buttons" ng-hide="button.hidden">
					<button ng-click="buttonClick(button)" id="cinema-{{id}}" type="button" class="btn btn-primary btn-mini" ng-disabled="loading">{{button.label}}</button>
				</li>
			</ul>
			<accordion close-others="false" ng-init="isOpen_favs=true; isOpen_london=true" >
				<accordion-group is-open="isOpen_favs">
					<accordion-heading>
						Favorite cinemas ({{(cineworld.cinemas | filter:{fav: true}).length}})
						<i class="pull-right" ng-class="{'icon-chevron-down': isOpen_favs, 'icon-chevron-right': !isOpen_favs}"></i>
					</accordion-heading>
					<ul class="unstyled" ng-show="!loading">
						<li ng-repeat="cinema in cineworld.cinemas | filter:{fav: true} | orderBy:'name'" ng-include="'cinema.shtml'" />
					</ul>
				</accordion-group>
				<accordion-group is-open="isOpen_london">
					<accordion-heading>
						London cinemas ({{(cineworld.cinemas | filter:{name:'London'}).length}})
						<i class="pull-right" ng-class="{'icon-chevron-down': isOpen_london, 'icon-chevron-right': !isOpen_london}"></i>
					</accordion-heading>
					<ul class="unstyled" ng-show="!loading">
						<li ng-repeat="cinema in (cineworld.cinemas | filter:{name:'London'}) | orderBy:'name'" ng-include="'cinema.shtml'" />
					</ul>
				</accordion-group>
				<accordion-group is-open="isOpen_others">
					<accordion-heading>
						Other cinemas ({{(cineworld.cinemas | filter:{name:'!London'}).length}})
						<i class="pull-right" ng-class="{'icon-chevron-down': isOpen_others, 'icon-chevron-right': !isOpen_others}"></i>
					</accordion-heading>
					<ul class="unstyled" ng-show="!loading">
						<li ng-repeat="cinema in (cineworld.cinemas | filter:{name:'!London'}) | orderBy:'name'" ng-include="'cinema.shtml'" />
					</ul>
				</accordion-group>
			</accordion>
		</section>
		<section id="films" class="ui-stretch" ng-controller="FilmsController">
			<div ng-show="loading">Loading films...</div>
			<ul class="unstyled" ng-show="!loading">
				<li ng-repeat="film in cineworld.films | orderBy:['title']">
					<input id="film-{{film.edi}}" type="checkbox" class="check" value="{{film.edi}}" ng-model="film.selected" />
					<label class="name" for="film-{{film.edi}}" title="{{film | json}}">{{film.title}}<span class="optional" ng-show="film.runtime > 0"> (<span class="runtime">{{film.runtime}}</span>)</label>
				</li>
			</ul>
		</section>
		<section id="performances" class="ui-stretch" ng-controller="PerformancesController">
			<div ng-show="loading">Loading performances...</div>
			<table ng-show="!loading">
				<thead>
					<tr>
						<th>Cinema</th>
						<th ng-repeat="film in cineworld.films | filter: {selected: true}">{{film.title}}</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="cinema in cineworld.cinemas | filter: {selected: true}">
						<td>{{cleanName(cinema.name)}}</td>
						<td ng-repeat="film in cineworld.films | filter: {selected: true}">
							perf[{{cinema.cineworldID}}][{{film.edi}}]
						</td>
					</tr>
				</tbody>
			</table>
		</section>
	</section>
	<div id="statusmessage" ng-show="stati.length > 0" ng-controller="StatusController">
		<div ng-repeat="status in stati track by $index">{{status}}</div>
	</div>
</body>
</html>
